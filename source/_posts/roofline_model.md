---
title: 性能分析的Roofline Model
categories: AI-HPC
---



## 七个基本指标

* 参数总量: 模型大小, 或者参数数量.

* 计算总量: 模型/算子进行加法/乘法的次数, 单位: `FLOPS`, 表示浮点运算的次数.
* 访存总量: 模型读写内存的总量.
* 算力: 计算总量 / 计算时间.
* 带宽: 访存总量 / 计算时间.



## Roofline Model

* 对于一个算法来说, 它有独立于平台的核心指标, 就是**计算总量**和**访存总量**.
* 现在, 我想知道这个算法, 在特定计算平台上运行的**最快速度**, Roofline Model就用来解决这个问题.

  * 要衡量一个平台的计算性能, 就需要用平台的**极限算力**和**极限带宽**.
* Roofline Model的核心在于: 我用计算平台的极限带宽去跑你的算法, 看看你的极限速度是多少:
  * 首先, 假设你自己的算法的计算量访存量之比是$I_0$, 平台的极限算力和带宽是$\pi, \beta$.
  * 然后计算用极限带宽跑你的算法, 能达到的算力: $\pi_0 = \frac{\pi}{\beta}I_0$
    * 如果$\pi_0 < \pi$,  那么说明, 即使你访存优化到极限, 还远远达不到平台的算力极限, 这个时候你优化访存的收益最大, 也就是memory-bound.
    * 如果$\pi_0 > \pi$, 那么说明, 访存优化到极限, 算力也上不去, 这个时候就需要优化计算量, 来让优化缓存的潜在收益变大, 也就是compute-bound.
